!function(){var e=angular.module("css-format",[]);e.factory("CSSComment",["CSSUtils",function(e){function t(e,t){this.raw=e||"",this.trimmed=this.raw.trim(),this.start=0,this.end=0,this.type=t||"selector"}return t.prototype.toString=function(){return this.trimmed},t}]),e.factory("CSSFormatter",["CSSLine","CSSComment","CSSParentSelector","CSSProperty","CSSSelectors","CSSUtils",function(e,t,n,r,i,s){function o(e,t){t=t||{},this._parser=e,this._options=angular.merge(this.defaultOptions(),t),this._lines=this.generateLines()}function a(){this.lines=[],this.current=new e,this.hasLines=function(){return this.lines.length||this.current.text().length}}return o.defaultOptions=function(){return{indent:4,selectors:{newLine:!0,linesBefore:0,linesBeforeComment:0,maxLength:90,forcePerLine:!1,combinatedPerLine:!0,linesBeforeMulti:0,multispace:1},braces:{openNewLine:!1,openIndent:1,openIndentAfter:0,closeNewLine:!0,closeIndent:0,closeIndentAfter:0},property:{newLine:!0,spaceBetween:1,closeLast:!0,indentAfter:0},comments:{render:!0,renderProperty:!0,renderPropertyInline:!0,linesBefore:2,linesAfter:0,inlineSpace:1}}},o.prototype.defaultOptions=function(){return o.defaultOptions()},o.prototype.getLines=function(){return this._lines},o.prototype.generateLines=function(){for(var p,f,e=this._parser,r=e.getSelectors(),s=new a,o=0;f=r[o];o++)f instanceof t?this.generateComment(f,0,s):f instanceof n?this.generateParentSelectors(f,p&&p instanceof t,0,s):f instanceof i&&(this.generateSelectors(f,p&&p instanceof t,0,s),this.generateProperties(f,0,s)),p=f;return s.newLine(0),s.lines},o.prototype.generateComment=function(e,n,r){var i=this._options.comments;if(i.render){r.hasLines()&&(r.newLine(n),this.addEmptyLines(i.linesBefore,n,r));for(var p,s=e.toString().split("\n"),o=0,a=s.length-1;p=s[o];o++)r.current.push(new t(p)),o!==a&&r.newLine(n);this.addEmptyLines(i.linesAfter,n,r)}},o.prototype.generateParentSelectors=function(e,r,s,o){var p=(this._parser,this._options);p.selectors.newLine&&o.hasLines()&&o.newLine(s),this.generateLinesBeforeSelector(o,s,null,r),o.current.push(e),this.generateOpeningBrace(o,s);for(var u,c,f=0;c=e.children[f];f++)c instanceof t?this.generateComment(c,s+p.indent,o):c instanceof n?this.generateParentSelectors(c,u&&u instanceof t,s+p.indent,o):c instanceof i&&(this.generateSelectors(c,u&&u instanceof t,s+p.indent,o),this.generateProperties(c,s+p.indent,o)),u=c;this.generateClosingBrace(o,s)},o.prototype.generateSelectors=function(e,t,n,r){function a(t,n){var r=t===e.selectors.length-1;r||n.push(","+s.spaces(o.multispace))}var i=this._options,o=i.selectors;i.selectors.newLine&&r.hasLines()&&r.newLine(n),this.generateLinesBeforeSelector(r,n,e,t);for(var u,p=0,f=e.selectors.length-1;u=e.selectors[p];p++){var c=[u];a(p,c);var l=function(){if(!o.maxLength)return!1;if(o.forcePerLine)return p!==f;if(o.combinatedPerLine&&u.hasCombinator())return 0!==r.current.text().length&&0!==p&&r.newLine(n),p!==f;var e=r.current.length()+c.toString().length;return p!==f&&e>o.maxLength}();r.current.push(c),l&&r.newLine(n)}i.braces.openNewLine&&r.newLine(n),this.generateOpeningBrace(r)},o.prototype.generateProperties=function(e,n,i){for(var l,o=this._options,a=o.property,p=o.comments,f=e.properties,u=0,c=f.length-1;l=f[u];u++)l instanceof t?p.renderProperty&&(a.newLine&&i.newLine(n),i.current.push([s.spaceChar,l])):l instanceof r&&(a.newLine&&i.newLine(n+o.indent),i.current.push([l.name(),":"]),a.spaceBetween&&i.current.push(s.spaces(a.spaceBetween)),i.current.push(l.value()),(c!==u||a.closeLast&&c===u)&&i.current.push(";"),l.comment&&(p.inlineSpace&&i.current.push(s.spaces(p.inlineSpace)),i.current.push(l.comment)),a.indentAfter&&i.current.push(s.spaces(a.indentAfter)));this.generateClosingBrace(i,n)},o.prototype.generateOpeningBrace=function(e,t){var n=e.current,r=this._options.braces;r.openNewLine&&e.newLine(t),r.openIndent&&n.push(s.spaces(r.openIndent)),n.push("{"),r.openIndentAfter&&n.push(s.spaces(r.openIndentAfter))},o.prototype.generateClosingBrace=function(e,t){var n=e.current,r=this._options.braces;r.closeNewLine&&e.newLine(t),r.closeIndent&&n.push(s.spaces(r.closeIndent)),e.current.push("}"),r.closeIndentAfter&&n.push(s.spaces(r.closeIndentAfter))},o.prototype.generateLinesBeforeSelector=function(e,t,n,r){var i=this._options.selectors,s=function(){if(!e.hasLines())return 0;var t=i.linesBefore;return r?t=i.linesBeforeComment:i.linesBeforeMulti&&(!n||n.selectors.length>1)&&(t=Math.max(t,i.linesBeforeMulti)),t}();this.addEmptyLines(s,t,e)},o.prototype.addEmptyLines=function(e,t,n){for(var r=0;e>r;r++)n.newLine(t);return e},o.prototype.toString=function(){for(var n,e="",t=0;n=this._lines[t];t++)e+=String.spaces(n.indent)+n+"\n";return e},a.prototype.newLine=function(t){this.lines.push(this.current),this.current=new e,this.current.indent=t||0},o}]),e.factory("CSSLine",[function(){function e(e,n){this._text=new t(n),this.indent=e||0}function t(e){this.push(e)}return e.prototype.text=function(e){return"undefined"!=typeof e&&(this._text=new t(e)),this._text},e.prototype.push=function(e){this._text.push(e)},e.prototype.length=function(){return this._text.toString().length},e.prototype.toString=function(){return this._text.toString()},t.prototype=new Array,t.prototype._push=t.prototype.push,t.prototype.push=function(e){function n(e,t){if(e instanceof Array)for(var r=0;r<e.length;r++)n(e[r]);else"undefined"!=typeof e&&t._push(e)}if(e instanceof Array)for(var t=0;t<e.length;t++)n(e[t],this);else"undefined"!=typeof e&&this._push(e)},t.prototype.toString=function(){for(var e="",t=0;t<this.length;t++)e+=this[t].toString();return e},e}]),e.factory("CSSParentSelector",[function(){function e(e){this.selector=e,this.children=[],this.start=0,this.end=0}return e.prototype.toString=function(){return this.selector},e}]),e.factory("CSSParser",["CSSComment","CSSParentSelector","CSSProperty","CSSSelectors","CSSSelector",function(e,t,n,r,i){function s(e){this.css=e,this.i=0,this.parentSelectors=["@media"]}function o(e){function u(){a&&r.push(a),a=null,i="none"}function c(){p&&a&&(a.properties.push(p),f=p,p=null)}var n="string"==typeof e?new s(e):e,r=this._selectors=[],i="none",a=null,p=null,f=null;if(n.css)for(var l;n.i<n.css.length;n.i++){var h=this.skipWhiteSpace(n);if(l=n.css[n.i],"/"===l){if("*"!==n.css[n.i+1])throw'Illegal character "/"';"none"==i?r.push(this.parseComment(n,"selector")):h&&a?a.properties.push(this.parseComment(n,"property")):!h&&f&&(f.comment=this.parseComment(n,"property-inline"))}else if("none"===i)if(this.matchAhead(n.parentSelectors,n)){var m=this.parseTill("{",n);n.i++;for(var g,S=new t(m.trim()),d=new o(n),v=0;g=d.getSelectors()[v];v++)S.children.push(g);r.push(S)}else{if("}"===l)break;if(a=this.parseSelectors(n),!a){u();continue}i="parse-property"}else if("parse-property"===i){if(p=this.parseProperty(n),p.isEnd){u();continue}i="parse-value"}else if("parse-value"===i){var m=this.parseValue(n,p);c(),m.isEnd?u():i="parse-property"}}}return o.prototype.getSelectors=function(){return this._selectors},o.prototype.skipWhiteSpace=function(e){for(var n,t=!1;(n=e.css[e.i])&&-1!==" 	\n\r".indexOf(n);e.i++)t||-1!==" 	".indexOf(n)||(t=!0);return t},o.prototype.parseTill=function(e,t){for(var r,n="";(r=t.css[t.i])&&r!==e;t.i++)n+=r;return n},o.prototype.matchAhead=function(e,t){for(var i,n=0,r=!0;i=t.parentSelectors[n];n++){for(var o,s=t.i;o=t.css[s];s++){var a=s-t.i;if(a===i.length)break;if(o!==i[a]){r=!1;break}}if(r)return i}return null},o.prototype.parseComment=function(t,n){for(var s,r="",i=t.i;(s=t.css[t.i])&&("\r"===s||(r+=s,"/"!==s||"*"!==t.css[t.i-1]));t.i++);var o=new e(r,n);return o.start=i,o.end=t.i,o},o.prototype.parseSelectors=function(e){var t="",n=[],s=new r(n);s.start=e.i;for(var o;o=e.css[e.i];e.i++){if("{"===o)return t=t.trim(),t&&n.push(new i(t)),s.end=e.i,s;if(","!==o){if("}"===o)break;t+=o}else t=t.trim(),n.push(new i(t)),t=""}if(t.trim())throw'End of document reached prematurely while parsing selectors: "'+n+'" ending with "'+t+'"';return null},o.prototype.parseProperty=function(e){var t=new n,r="";t.start=e.i;for(var i;i=e.css[e.i];e.i++){if(":"===i)return t.name(r),t;if("}"===i){if(r.trim())throw"Premature end while parsing property: "+r;return t.name(r),t.isEnd=!0,t.end=e.i,t}r+=i}throw"End of document reached prematurely while parsing property: "+r},o.prototype.parseValue=function(e,t){for(var o,n="",r=null,i="value";o=e.css[e.i];e.i++){if("'"===o||'"'===o)"literal"===i&&r===o?i="value":"value"===i&&(i="literal",r=o);else if((";"===o||"}"===o)&&"value"===i)break;n+=o}return t.value(n),t.isEnd="}"===o,t.end=e.i,t},o}]),e.factory("CSSProperty",["CSSPropertyName","CSSPropertyValue","CSSUtils",function(e,t,n){function r(n,r){this._name="string"==typeof n?new e(n):null,this._value="string"==typeof r?new t(r):null,this.comment=null,this.start=0,this.end=0}return r.prototype.name=function(t){return"undefined"==typeof t?this._name:this._name=new e(t)},r.prototype.value=function(e){return"undefined"==typeof e?this._value:this._value=new t(e)},r.prototype.toString=function(e,t){var r=n.indent(this.name()+": "+this.value()+";",e,t);return this.comment&&(r+=" "+this.comment),r},r}]),e.factory("CSSPropertyName",[function(){function e(e){this.name=e.trim()}return e.prototype.toString=function(){return this.name},e}]),e.factory("CSSPropertyValue",[function(){function e(e){this.value=e.trim()}return e.prototype.toString=function(){return this.value},e}]),e.factory("CSSSelector",[function(){function e(e){this.name=e.trim()}return e.prototype.hasCombinator=function(){return-1!==this.name.indexOf(" ")||-1!==this.name.indexOf(">")||-1!==this.name.indexOf("+")||-1!==this.name.indexOf("~")},e.prototype.toString=function(){return this.name},e}]),e.factory("CSSSelectors",["CSSUtils",function(e){function t(e,t){this.selectors=e||[],this.properties=t||[],this.start=0,this.end=0}return t.prototype.toString=function(){return this.selectors.toString()},t}]),e.factory("CSSTableOfContents",["CSSComment","CSSFormatter","CSSLine","CSSUtils",function(e,t,n,r){function i(n,i){this._options=i=i||{};var s=new t(n,i),o=s.getLines(),a=this._output=this.generateTableLines(o);if(i.showLineNumbers)for(var f,p=0;f=a[p];p++)if(f.comment){var u=this.getCommentLineIndex(f.comment,o);if(u>=0){var c=f.text().toString().substr(1+2*r.spaceChar.length),l=r.minLeft((u+a.length+1).toString(),5);f.text(new e("*"+l+c))}}for(var m,p=0,h=0;m=o[p];p++){if(i.tocIndent){for(var d,c=m.text(),S=0;d=c[S];S++)if("number"==typeof d.tableIndent){h=d.tableIndent;break}m.indent+=h}a.push(m)}}return i.prototype.getLines=function(){return this._output},i.prototype.getCommentLineIndex=function(e,t){for(var r,n=0;r=t[n];n++)for(var s,i=0;s=r.text()[i];i++)if(s===e)return n;return-1},i.prototype.generateTableLines=function(t){for(var f,i=[],s=[],o={},a=this._options,p=0;f=t[p];p++){var u=f.text(),c=u.toString();if(u[0]instanceof e&&0===c.indexOf("/*")){var l=this.getDepthString(u[0]);if(1===l.length)continue;i.push(u[0]),o[l]=0}}for(var h in o)s.push(h);for(s.sort(),s.reverse(),p=0,l;l=s[p];p++)o[l]=p+1;var t=[],m="number"==typeof a.depthIndent?a.depthIndent:4;t.push(new n(0,new e("/*"))),t.push(new n(1,new e("* TABLE OF CONTENTS"))),t.push(new n(1,new e("*")));for(var S,p=0;S=i[p];p++){var l=this.getDepthString(S),d=o[l],v=this.extractComment(S);if(v){var f=new n(1,new e("*"+r.indent("- "+v,d)));f.comment=S,S.tableIndent=f.tableIndent=(d-1)*m,t.push(f)}}return t.push(new n(1,new e("*"))),t.push(new n(1,new e("*/"))),t.push(new n(0)),t.push(new n(0)),t.depthSet=o,t},i.prototype.getDepthString=function(e){for(var t="",n=1;n<e.trimmed.length;n++){var r=e.trimmed[n];if("*"!==r)break;t+="*"}return t},i.prototype.extractComment=function(e){for(var n,o,t=e.trimmed.substr(1,e.trimmed.length-2),r="",i=!1,s=0;o=t[s];s++){if("	"===o)o="    ",i=!0;else{if("\r"===o||"\n"===o)break;if("*"===o&&!i)continue}i=!0,r+=o}for(var o,s=r.length-1;o=r[s];s--)if("*"!==o){n=r.substr(0,s);break}return n.trim()},i.prototype.toString=function(){for(var n,e="",t=0;n=this._output[t];t++)e+=r.spaces(n.indent)+n.text+"\n";return e},i}]),e.factory("CSSUtils",[function(){var e;return e={spaceChar:"&nbsp;",indentString:"&nbsp;&nbsp;&nbsp;&nbsp;",indent:function(t,n,r){n="number"==typeof n?n:1,r="undefined"==typeof r?e.indentString:r;for(var i="",s=0;n>s;s++)i+=r;return i+t},spaces:function(t,n){for(var r="",i=0;t>i;i++)r+=n||e.spaceChar;return r},padLeft:function(t,n,r){r=r||e.spaceChar;for(var i=0;n>i;i++)t=r+t;return t},minLeft:function(t,n,r){r=r||e.spaceChar;for(var i=t.length,s=0;n>i+s;)t=r+t,s++;return t}}}]),e.directive("cssLines",["CSSComment","CSSParentSelector","CSSSelector","CSSPropertyName","CSSPropertyValue","CSSUtils",function(e,t,n,r,i,s){var o=angular.element;return{restrict:"A",scope:{lines:"=cssLines"},link:function(a,p,f){a.$watch("lines",function(){if(p.html(""),a.lines)for(var u,f=0;u=a.lines[f];f++){var c=o('<div class="css-line"></div>');if(p.append(c),0!==u.text().length){u.indent&&c.append('<span class="indent">'+s.spaces(u.indent)+"</span>");for(var h,l=0;h=u.text()[l];l++){var m;m=h instanceof e?"css-comment "+h.type:h instanceof t?"css-selector":h instanceof n?"css-selector":h instanceof r?"css-property-name":h instanceof i?"css-property-value":"css-text",m?c.append('<span class="'+m+'">'+h+"</span>"):c.append("<span>"+h+"</span>")}}else c.append("<span>&nbsp;</span>")}})}}}])}();