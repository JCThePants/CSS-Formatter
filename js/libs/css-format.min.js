!function(){var e=angular.module("css-format",[]);e.factory("CSSComment",["CSSUtils",function(e){function t(e,t){this.raw=e||"",this.trimmed=this.raw.trim(),this.start=0,this.end=0,this.type=t||"selector"}return t.prototype.toString=function(){return this.trimmed},t}]),e.factory("CSSFormatter",["CSSLine","CSSComment","CSSParentSelector","CSSProperty","CSSSelectors","CSSUtils",function(e,t,n,r,i,a){function s(e,t){t=t||{},this._parser=e,this._options=angular.merge(this.defaultOptions(),t),this._lines=this.generateLines()}function o(){this.lines=[],this.current=new e,this.hasLines=function(){return this.lines.length||this.current.text().length}}return s.defaultOptions=function(){return{indent:4,selectors:{newLine:!0,linesBefore:0,linesBeforeComment:0,maxLength:90,forcePerLine:!1,combinatedPerLine:!0,linesBeforeMulti:0,multispace:1},braces:{openNewLine:!1,openIndent:1,openIndentAfter:0,closeNewLine:!0,closeIndent:0,closeIndentAfter:0},property:{newLine:!0,spaceBetween:1,closeLast:!0,indentAfter:0},comments:{render:!0,renderProperty:!0,renderPropertyInline:!0,linesBefore:2,linesAfter:0,inlineSpace:1}}},s.prototype.defaultOptions=function(){return s.defaultOptions()},s.prototype.getLines=function(){return this._lines},s.prototype.generateLines=function(){for(var l,c,e=this._parser,a=(this._options,e.getSelectors()),s=new o,u=0;c=a[u];u++)c instanceof t?this.generateComment(c,0,s):c instanceof n?this.generateParentSelectors(c,l&&l instanceof t,0,s):c instanceof i&&(this.generateSelectors(c,l&&l instanceof t,0,s),this.generateProperties(c,0,s)),l=c;return s.newLine(0),s.lines},s.prototype.generateComment=function(e,n,r){var i=this._options;if(i.comments.render){r.hasLines()&&(r.newLine(n),this.addEmptyLines(i.comments.linesBefore,n,r));for(var u,a=e.toString().split("\n"),s=0,o=a.length-1;u=a[s];s++)r.current.push(new t(u)),s!==o&&r.newLine(n);this.addEmptyLines(i.comments.linesAfter,n,r)}},s.prototype.generateParentSelectors=function(e,r,a,s){var u=(this._parser,this._options);u.selectors.newLine&&s.hasLines()&&s.newLine(a),this.generateLinesBeforeSelector(s,a,null,r),s.current.push(e),this.generateOpeningBrace(s,a);for(var c,f,l=0;f=e.children[l];l++)f instanceof t?this.generateComment(f,a+u.indent,s):f instanceof n?this.generateParentSelectors(f,c&&c instanceof t,a+u.indent,s):f instanceof i&&(this.generateSelectors(f,c&&c instanceof t,a+u.indent,s),this.generateProperties(f,a+u.indent,s)),c=f;this.generateClosingBrace(s,a)},s.prototype.generateSelectors=function(e,t,n,r){function o(t,n){var r=t===e.selectors.length-1;r||n.push(","+a.spaces(s.multispace))}var i=this._options,s=i.selectors;i.selectors.newLine&&r.hasLines()&&r.newLine(n),this.generateLinesBeforeSelector(r,n,e,t);for(var c,u=0,l=e.selectors.length-1;c=e.selectors[u];u++){var f=[c];o(u,f);var p=function(){if(!s.maxLength)return!1;if(i.selectors.forcePerLine)return u!==l;if(s.combinatedPerLine&&c.hasCombinator())return 0!==r.current.text().length&&0!==u&&r.newLine(n),u!==l;var e=r.current.length()+f.toString().length;return u!==l&&e>s.maxLength}();r.current.push(f),p&&r.newLine(n)}i.braces.openNewLine&&r.newLine(n),this.generateOpeningBrace(r)},s.prototype.generateProperties=function(e,n,i){for(var c,s=this._options,o=e.properties,u=0,l=o.length-1;c=o[u];u++)c instanceof t?s.comments.renderProperty&&(s.property.newLine&&i.newLine(n),i.current.push([a.spaceChar,c])):c instanceof r&&(s.property.newLine&&i.newLine(n+s.indent),i.current.push([c.name(),":"]),s.property.spaceBetween&&i.current.push(a.spaces(s.property.spaceBetween)),i.current.push(c.value()),(l!==u||s.property.closeLast&&l===u)&&i.current.push(";"),c.comment&&(s.comments.inlineSpace&&i.current.push(a.spaces(s.comments.inlineSpace)),i.current.push(c.comment)),s.property.indentAfter&&i.current.push(a.spaces(s.property.indentAfter)));this.generateClosingBrace(i,n)},s.prototype.generateOpeningBrace=function(e,t){var n=this._options;n.braces.openNewLine&&e.newLine(t),n.braces.openIndent&&e.current.push(a.spaces(n.braces.openIndent)),e.current.push("{"),n.braces.openIndentAfter&&e.current.push(a.spaces(n.braces.openIndentAfter))},s.prototype.generateClosingBrace=function(e,t){var n=this._options;n.braces.closeNewLine&&e.newLine(t),n.braces.closeIndent&&e.current.push(a.spaces(n.braces.closeIndent)),e.current.push("}"),n.braces.closeIndentAfter&&e.current.push(a.spaces(n.braces.closeIndentAfter))},s.prototype.generateLinesBeforeSelector=function(e,t,n,r){var i=this._options.selectors,a=function(){if(!e.hasLines())return 0;var t=i.linesBefore;return r?t=i.linesBeforeComment:i.linesBeforeMulti&&(!n||n.selectors.length>1)&&(t=Math.max(t,i.linesBeforeMulti)),t}();this.addEmptyLines(a,t,e)},s.prototype.addEmptyLines=function(e,t,n){for(var r=0;e>r;r++)n.newLine(t);return e},s.prototype.toString=function(){for(var n,e="",t=0;n=this._lines[t];t++)e+=String.spaces(n.indent)+n+"\n";return e},o.prototype.newLine=function(t){this.lines.push(this.current),this.current=new e,this.current.indent=t||0},s}]),e.factory("CSSLine",[function(){function e(e,n){this._text=new t(n),this.indent=e||0}function t(e){this.push(e)}return e.prototype.text=function(e){return"undefined"!=typeof e&&(this._text=new t(e)),this._text},e.prototype.push=function(e){this._text.push(e)},e.prototype.length=function(){return this._text.toString().length},e.prototype.toString=function(){return this._text.toString()},t.prototype=new Array,t.prototype._push=t.prototype.push,t.prototype.push=function(e){function n(e,t){if(e instanceof Array)for(var r=0;r<e.length;r++)n(e[r]);else"undefined"!=typeof e&&t._push(e)}if(e instanceof Array)for(var t=0;t<e.length;t++)n(e[t],this);else"undefined"!=typeof e&&this._push(e)},t.prototype.toString=function(){for(var e="",t=0;t<this.length;t++)e+=this[t].toString();return e},e}]),e.factory("CSSParentSelector",[function(){function e(e){this.selector=e,this.children=[],this.start=0,this.end=0}return e.prototype.toString=function(){return this.selector},e}]),e.factory("CSSParser",["CSSComment","CSSParentSelector","CSSProperty","CSSSelectors","CSSSelector",function(e,t,n,r,i){function a(e){this.css=e,this.i=0}function s(e){function c(){o&&r.push(o),o=null,i="none"}function f(){u&&o&&(o.properties.push(u),l=u,u=null)}var n="string"==typeof e?new a(e):e,r=this._selectors=[],i="none",o=null,u=null,l=null;if(n.css)for(var p;n.i<n.css.length;n.i++){var d=this.skipWhiteSpace(n);if(p=n.css[n.i],"/"===p){if("*"!==n.css[n.i+1])throw'Illegal character "/"';"none"==i?r.push(this.parseComment(n,"selector")):d&&o?o.properties.push(this.parseComment(n,"property")):!d&&l&&(l.comment=this.parseComment(n,"property-inline"))}else if("@"===p){var h=this.parseTill("{",n);n.i++;for(var y,m=new t(h.trim()),v=new s(n),g=0;y=v.getSelectors()[g];g++)m.children.push(y);r.push(m)}else if("none"===i){if("}"===p)break;if(o=this.parseSelectors(n),!o){c();continue}i="parse-property"}else if("parse-property"===i){if(u=this.parseProperty(n),u.isEnd){c();continue}i="parse-value"}else if("parse-value"===i){var h=this.parseValue(n,u);f(),h.isEnd?c():i="parse-property"}}}return s.prototype.getSelectors=function(){return this._selectors},s.prototype.skipWhiteSpace=function(e){for(var n,t=!1;(n=e.css[e.i])&&-1!==" 	\n\r".indexOf(n);e.i++)t||-1!==" 	".indexOf(n)||(t=!0);return t},s.prototype.parseTill=function(e,t){for(var r,n="";(r=t.css[t.i])&&r!==e;t.i++)n+=r;return n},s.prototype.parseComment=function(t,n){for(var a,r="",i=t.i;(a=t.css[t.i])&&("\r"===a||(r+=a,"/"!==a||"*"!==t.css[t.i-1]));t.i++);var s=new e(r,n);return s.start=i,s.end=t.i,s},s.prototype.parseSelectors=function(e){var t="",n=[],a=new r(n);a.start=e.i;for(var s;s=e.css[e.i];e.i++){if("{"===s)return t=t.trim(),t&&n.push(new i(t)),a.end=e.i,a;if(","!==s){if("}"===s)break;t+=s}else t=t.trim(),n.push(new i(t)),t=""}if(t.trim())throw'End of document reached prematurely while parsing selectors: "'+n+'" ending with "'+t+'"';return null},s.prototype.parseProperty=function(e){var t=new n,r="";t.start=e.i;for(var i;i=e.css[e.i];e.i++){if(":"===i)return t.name(r),t;if("}"===i){if(r.trim())throw"Premature end while parsing property: "+r;return t.name(r),t.isEnd=!0,t.end=e.i,t}r+=i}throw"End of document reached prematurely while parsing property: "+r},s.prototype.parseValue=function(e,t){for(var s,n="",r=null,i="value";s=e.css[e.i];e.i++){if("'"===s||'"'===s)"literal"===i&&r===s?i="value":"value"===i&&(i="literal",r=s);else if((";"===s||"}"===s)&&"value"===i)break;n+=s}return t.value(n),t.isEnd="}"===s,t.end=e.i,t},s}]),e.factory("CSSProperty",["CSSPropertyName","CSSPropertyValue","CSSUtils",function(e,t,n){function r(n,r){this._name="string"==typeof n?new e(n):null,this._value="string"==typeof r?new t(r):null,this.comment=null,this.start=0,this.end=0}return r.prototype.name=function(t){return"undefined"==typeof t?this._name:this._name=new e(t)},r.prototype.value=function(e){return"undefined"==typeof e?this._value:this._value=new t(e)},r.prototype.toString=function(e,t){var r=n.indent(this.name()+": "+this.value()+";",e,t);return this.comment&&(r+=" "+this.comment),r},r}]),e.factory("CSSPropertyName",[function(){function e(e){this.name=e.trim()}return e.prototype.toString=function(){return this.name},e}]),e.factory("CSSPropertyValue",[function(){function e(e){this.value=e.trim()}return e.prototype.toString=function(){return this.value},e}]),e.factory("CSSSelector",[function(){function e(e){this.name=e.trim()}return e.prototype.hasCombinator=function(){return-1!==this.name.indexOf(" ")||-1!==this.name.indexOf(">")||-1!==this.name.indexOf("+")||-1!==this.name.indexOf("~")},e.prototype.toString=function(){return this.name},e}]),e.factory("CSSSelectors",["CSSUtils",function(e){function t(e,t){this.selectors=e||[],this.properties=t||[],this.start=0,this.end=0}return t.prototype.toString=function(){return this.selectors.toString()},t}]),e.factory("CSSTableOfContents",["CSSComment","CSSFormatter","CSSLine","CSSUtils",function(e,t,n,r){function i(n,i){this._options=i=i||{};var a=new t(n,i),s=a.getLines(),o=this._output=this.generateTableLines(s);if(i.showLineNumbers)for(var l,u=0;l=o[u];u++)if(l.comment){var c=this.getCommentLineIndex(l.comment,s);if(c>=0){var f=l.text().toString().substr(1+2*r.spaceChar.length),p=r.minLeft((c+o.length+1).toString(),5);l.text(new e("*"+p+f))}}for(var h,u=0,d=0;h=s[u];u++){if(i.tocIndent){for(var v,f=h.text(),m=0;v=f[m];m++)if("number"==typeof v.tableIndent){d=v.tableIndent;break}h.indent+=d}o.push(h)}}return i.prototype.getLines=function(){return this._output},i.prototype.getCommentLineIndex=function(e,t){for(var r,n=0;r=t[n];n++)for(var a,i=0;a=r.text()[i];i++)if(a===e)return n;return-1},i.prototype.generateTableLines=function(t){for(var l,i=[],a=[],s={},o=this._options,u=0;l=t[u];u++){var c=l.text(),f=c.toString();if(c[0]instanceof e&&0===f.indexOf("/*")){var p=this.getDepthString(c[0]);if(1===p.length)continue;i.push(c[0]),s[p]=0}}for(var d in s)a.push(d);for(a.sort(),a.reverse(),u=0,p;p=a[u];u++)s[p]=u+1;var t=[],h="number"==typeof o.depthIndent?o.depthIndent:4;t.push(new n(0,new e("/*"))),t.push(new n(1,new e("* TABLE OF CONTENTS"))),t.push(new n(1,new e("*")));for(var m,u=0;m=i[u];u++){var p=this.getDepthString(m),v=s[p],g=this.extractComment(m);if(g){var l=new n(1,new e("*"+r.indent("- "+g,v)));l.comment=m,m.tableIndent=l.tableIndent=(v-1)*h,t.push(l)}}return t.push(new n(1,new e("*"))),t.push(new n(1,new e("*/"))),t.push(new n(0)),t.push(new n(0)),t.depthSet=s,t},i.prototype.getDepthString=function(e){for(var t="",n=1;n<e.trimmed.length;n++){var r=e.trimmed[n];if("*"!==r)break;t+="*"}return t},i.prototype.extractComment=function(e){for(var n,s,t=e.trimmed.substr(1,e.trimmed.length-2),r="",i=!1,a=0;s=t[a];a++){if("	"===s)s="    ",i=!0;else{if("\r"===s||"\n"===s)break;if("*"===s&&!i)continue}i=!0,r+=s}for(var s,a=r.length-1;s=r[a];a--)if("*"!==s){n=r.substr(0,a);break}return n.trim()},i.prototype.toString=function(){for(var n,e="",t=0;n=this._output[t];t++)e+=r.spaces(n.indent)+n.text+"\n";return e},i}]),e.factory("CSSUtils",[function(){var e;return e={spaceChar:"&nbsp;",indentString:"&nbsp;&nbsp;&nbsp;&nbsp;",indent:function(t,n,r){n="number"==typeof n?n:1,r="undefined"==typeof r?e.indentString:r;for(var i="",a=0;n>a;a++)i+=r;return i+t},spaces:function(t,n){for(var r="",i=0;t>i;i++)r+=n||e.spaceChar;return r},padLeft:function(t,n,r){r=r||e.spaceChar;for(var i=0;n>i;i++)t=r+t;return t},minLeft:function(t,n,r){r=r||e.spaceChar;for(var i=t.length,a=0;n>i+a;)t=r+t,a++;return t}}}]),e.directive("cssLines",["CSSComment","CSSParentSelector","CSSSelector","CSSPropertyName","CSSPropertyValue","CSSUtils",function(e,t,n,r,i,a){var s=angular.element;return{restrict:"A",scope:{lines:"=cssLines"},link:function(o,u,l){o.$watch("lines",function(){if(u.html(""),o.lines)for(var c,l=0;c=o.lines[l];l++){var f=s('<div class="css-line"></div>');if(u.append(f),0!==c.text().length){c.indent&&f.append('<span class="indent">'+a.spaces(c.indent)+"</span>");for(var d,p=0;d=c.text()[p];p++){var h;h=d instanceof e?"css-comment "+d.type:d instanceof t?"css-selector":d instanceof n?"css-selector":d instanceof r?"css-property-name":d instanceof i?"css-property-value":"css-text",h?f.append('<span class="'+h+'">'+d+"</span>"):f.append("<span>"+d+"</span>")}}else f.append("<span>&nbsp;</span>")}})}}}])}();